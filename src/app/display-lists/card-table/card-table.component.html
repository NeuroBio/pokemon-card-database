<form [formGroup]="filterForm" id="filter-row">
    <mat-form-field>
        <mat-label>Dex</mat-label>
        <input matInput type="number" min="1" formControlName="dex">
    </mat-form-field>
</form>


<table mat-table [dataSource]="cards" multiTemplateDataRows
    matSort (matSortChange)="sortData($event)">

    <!-- DropDown -->
    <ng-container [matColumnDef]="displayColumns[0]">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let card">
            <button mat-icon-button color="prime" class="drop-button"
            [disabled]="card.owned.length === 0"
            (click)="expanded = card === expanded ? undefined : card">
                <mat-icon [ngClass]="card === expanded ? 'rotate' : 'origin'">
                    chevron_right
                </mat-icon>
            </button>
        </td>
    </ng-container>

    <!-- Dex -->
    <ng-container [matColumnDef]="displayColumns[1]">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ displayColumns[1] }}</th>
        <td mat-cell *matCellDef="let card"> {{ card.dexNumber }} </td>
    </ng-container>

    <!-- Name -->
    <ng-container [matColumnDef]="displayColumns[2]">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ displayColumns[2] }}</th>
        <td mat-cell *matCellDef="let card"> {{ card.cardTitle }} </td>
    </ng-container>

    <!-- Expansion -->
    <ng-container [matColumnDef]="displayColumns[3]">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ displayColumns[3] }}</th>
        <td mat-cell *matCellDef="let card"> {{ card.expansionName }} </td>
    </ng-container>

    <!-- Generation -->
    <ng-container [matColumnDef]="displayColumns[4]">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ displayColumns[4] }}</th>
        <td mat-cell *matCellDef="let card"> {{ card.generation }} </td>
    </ng-container>

    <!-- Relase -->
    <ng-container [matColumnDef]="displayColumns[5]">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ displayColumns[5] }}</th>
        <td mat-cell *matCellDef="let card"> {{ card.release }} </td>
    </ng-container>

    <!-- Print -->
    <ng-container [matColumnDef]="displayColumns[6]">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ displayColumns[6] }}</th>
        <td mat-cell *matCellDef="let card"> {{ card.printNumber }}/{{ card.numCards }} </td>
    </ng-container>

    <!-- Copies -->
    <ng-container [matColumnDef]="displayColumns[7]">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ displayColumns[7] }}</th>
        <td mat-cell *matCellDef="let card"> {{ card.conditionCount() }} </td>
    </ng-container>

    <!-- Individual Cards -->
    <ng-container matColumnDef="expandedDetail">
        <td mat-cell *matCellDef="let card" [attr.colspan]="displayColumns.length">
            <div [@detailExpand]="expanded === card ? 'expanded' : 'collapsed'">
                <div *ngFor="let instance of card.owned">
                    <!-- images of the card -->
                    <div class="image-holder">
                        <div *ngIf="instance.front">
                            <img src="instance.front">
                        </div>
                        <div *ngIf="instance.back">
                            <img src="instance.back">
                        </div>    
                    </div>

                    <!-- Card state -->
                    {{ instance.form }} {{ instance.condition }}
                    <div class="tab" *ngFor="let flaw of instance.flaws">
                        - {{ flaw.severity }} {{ flaw.type }} {{ flaw.where }}  {{ flaw.landmark }}
                    </div>
                </div>
            </div>
        </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayColumns" class="header-row"></tr>
    <tr mat-row *matRowDef="let row; columns: displayColumns;" class="main-rows"></tr>

    <tr mat-row *matRowDef="let card; columns: ['expandedDetail']" class="drop-down"></tr>
</table>
